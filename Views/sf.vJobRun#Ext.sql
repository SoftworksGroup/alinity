SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [sf].[vJobRun#Ext]
as
/*********************************************************************************************************************************
View    : sf.vJobRun#Ext
Notice  : Copyright Â© 2019 Softworks Group Inc.
Summary : extends the sf.JobRun base entity with calculated values, entity properties and columns from related tables
-----------------------------------------------------------------------------------------------------------------------------------
Author  : Generated by DB Studio: pEVGen | Designer: Tim Edlund
Version : March 2019
-----------------------------------------------------------------------------------------------------------------------------------
Comments
--------
This view includes the primary key of the table but no other content from the base entity. Descriptive columns from parent tables
and a set of columns required by the Entity Framework (EF) are provided. The content of this view is joined with the table columns
to provide complete attribution of the entity in the view vJobRun (referred to as the "entity" view in SGI documentation).

Columns required to support the EF include constants passed by client and middle tier modules into the table API procedures as
parameters. These values control the insert/update/delete behaviour of the sprocs. For example: the IsNullApplied bit is set ON
in the view so that update procedures overwrite column values when matching parameters are NULL on calls from the client tier.
The default for this column in the call signature of the sproc is 0 (off) so that calls from the back-end do not overwrite with
null values.  The zContext XML value is always null but is required for binding to sproc calls using EF and RIA.

You can add additional columns, joins and examples of calling syntax, by placing them between the code tag pairs provided.  Items
placed within code tag pairs are preserved on regeneration.  Note that all additions to this view become part of the base product
and deploy for all client configurations.  This view is NOT an extension point for client-specific configurations.

-------------------------------------------------------------------------------------------------------------------------------- */

select
	 jr.JobRunSID
	,jb.JobSCD
	,jb.JobLabel
	,jb.IsCancelEnabled
	,jb.IsParallelEnabled
	,jb.IsFullTraceEnabled
	,jb.IsAlertOnSuccessEnabled
	,jb.JobScheduleSID
	,jb.JobScheduleSequence
	,jb.IsRunAfterPredecessorsOnly
	,jb.MaxErrorRate
	,jb.MaxRetriesOnFailure
	,jb.IsActive                                                            JobIsActive
	,jb.RowGUID                                                             JobRowGUID
	,sf.fJobRun#IsDeleteEnabled(jr.JobRunSID)                               IsDeleteEnabled						--# Indicates whether deletion of record is allowed | May be blocked by child records, security grants, and table-specific logic (see function)
	,cast(1 as tinyint)                                                     IsReselected							-- parameter for sproc calls through EF - reselects row as dataset
	,cast(1 as bit)                                                         IsNullApplied							-- parameter for sproc calls through EF - writes null parameter values
	,cast(null as xml)                                                      zContext									-- parameter for sproc calls through EF - utility parameter for customization
  --! <MoreColumns>
	,zx.JobStatusSCD																																									--# A system assigned code indicating the current status of the job
	,zx.JobStatusLabel																																								--# A configurable label indicating the status of the job for presentation to the end user	
	,zx.RecordsPerMinute																																							--# The number of records processed by the job per minute | This value is only available when record counts are provided by the job.
	,zx.RecordsRemaining																																							--# The number of records remaining to be processed | This value is only available when record counts are provided by the job.
	,zx.EstimatedMinutesRemaining																																			--# The number of minutes estimated for the job to complete processing | This value is only available when record counts are provided by the job.
	,zx.EstimatedEndTime																																							--# The time the job is estimated to be complete (converted for the client time zone) | This value is only available when record counts are provided by the job.
	,zx.DurationMinutes																																								--# The total amount of time the job took to run | This value is updated as the job is running
	,sf.fDTOffsetToClientDateTime(jr.StartTime)															StartTimeClientTZ					--# Start time of the job - converted to the client timezone
	,sf.fDTOffsetToClientDateTime(jr.EndTime)																EndTimeClientTZ						--# End time of the job - converted to the client timezone
	,sf.fDTOffsetToClientDateTime(jr.CancellationRequestTime)								CancellationRequestTimeClientTZ --# The time cancellation of the job was requested - converted to the client timezone
  --! </MoreColumns>
from
	sf.JobRun    jr
join
	sf.Job       jb     on jr.JobSID = jb.JobSID
--! <MoreJoins>
outer apply
	sf.fJobRun#Ext(jr.JobRunSID) zx
--! </MoreJoins>
GO
EXEC sp_addextendedproperty N'MS_Description', N'Unique sequential identifier for the job run assigned by the system | Primary key - not editable', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'JobRunSID'
GO
EXEC sp_addextendedproperty N'MS_Description', N'Unique code assigned by the product to identify the job | The code is not editable and records cannot be added or deleted from this table', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'JobSCD'
GO
EXEC sp_addextendedproperty N'MS_Description', N'Short (max 35 characters) label for the job to present in lists and look ups (must be unique)', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'JobLabel'
GO
EXEC sp_addextendedproperty N'MS_Description', N'Indicates whether or not this job can be cancelled by the user once in progress.', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'IsCancelEnabled'
GO
EXEC sp_addextendedproperty N'MS_Description', N'Indicates whether multiple instances of this job can be run at the same time | If not enabled, attempts to call the procedure a second time while another copy is running block the second call', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'IsParallelEnabled'
GO
EXEC sp_addextendedproperty N'MS_Description', N'Indicates whether a detailed log of job progress should be stored in addition to recording error messages  | This value is used for debugging by the Help Desk and should generally be turned off to allow processes to run more quickly.', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'IsFullTraceEnabled'
GO
EXEC sp_addextendedproperty N'MS_Description', N'Indicates an alert should be sent summarizing the results of the job when it completes successfully | Note that alerts on errors are always sent.  The alert is sent to the queue specified.', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'IsAlertOnSuccessEnabled'
GO
EXEC sp_addextendedproperty N'MS_Description', N'The job schedule assigned to this job - if any | If the job was not scheduled, this value is blank.', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'JobScheduleSID'
GO
EXEC sp_addextendedproperty N'MS_Description', N'A number used to control the order this job will start compared with other jobs assigned to the same schedule', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'JobScheduleSequence'
GO
EXEC sp_addextendedproperty N'MS_Description', N'Indicates this job should only be run when other jobs assigned to the same schedule and started earlier have completed successfully | To enable a schedule must be assigned and sequence number must be greater than 0', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'IsRunAfterPredecessorsOnly'
GO
EXEC sp_addextendedproperty N'MS_Description', N'The maximum error rate, as a percent of all records processed, that should be allowed to occur in the process before it automatically aborts (0 for no limit) | Note that this value is not considered until at least 100 records have been processed so the parameter has no impact on jobs with record counts < 100.', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'MaxErrorRate'
GO
EXEC sp_addextendedproperty N'MS_Description', N'For scheduled jobs, the maximum number of consecutive occurrences of the job should be called where they end in failure - 0 for no limit| Failed jobs with the IsFailureCleared bit set to 1 in the Job Run table are not included in this count', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'MaxRetriesOnFailure'
GO
EXEC sp_addextendedproperty N'MS_Description', N'Indicates this job record is in active use; un-check to eliminate from new record dialogs and active search results', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'JobIsActive'
GO
EXEC sp_addextendedproperty N'MS_Description', N'System assigned globally unique identifier for the job record used for offline synchronization | This is a GUID value with the "RowGUID" SQL Server property set', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'JobRowGUID'
GO
EXEC sp_addextendedproperty N'MS_Description', N'Indicates whether deletion of record is allowed | May be blocked by child records, security grants, and table-specific logic (see function)', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'IsDeleteEnabled'
GO
EXEC sp_addextendedproperty N'MS_Description', N'Parameter used by the application to control whether the record should be reselected after update (not displayed)', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'IsReselected'
GO
EXEC sp_addextendedproperty N'MS_Description', N'Parameter used by the application to control whether blank values provided from the UI end should overwrite content (not displayed)', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'IsNullApplied'
GO
EXEC sp_addextendedproperty N'MS_Description', N'Parameter used by the application to allow the database API procedures to accept customized parameters (not displayed)', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'zContext'
GO
EXEC sp_addextendedproperty N'MS_Description', N'A system assigned code indicating the current status of the job', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'JobStatusSCD'
GO
EXEC sp_addextendedproperty N'MS_Description', N'A configurable label indicating the status of the job for presentation to the end user	', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'JobStatusLabel'
GO
EXEC sp_addextendedproperty N'MS_Description', N'The number of records processed by the job per minute | This value is only available when record counts are provided by the job.', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'RecordsPerMinute'
GO
EXEC sp_addextendedproperty N'MS_Description', N'The number of records remaining to be processed | This value is only available when record counts are provided by the job.', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'RecordsRemaining'
GO
EXEC sp_addextendedproperty N'MS_Description', N'The number of minutes estimated for the job to complete processing | This value is only available when record counts are provided by the job.', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'EstimatedMinutesRemaining'
GO
EXEC sp_addextendedproperty N'MS_Description', N'The time the job is estimated to be complete (converted for the client time zone) | This value is only available when record counts are provided by the job.', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'EstimatedEndTime'
GO
EXEC sp_addextendedproperty N'MS_Description', N'The total amount of time the job took to run | This value is updated as the job is running', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'DurationMinutes'
GO
EXEC sp_addextendedproperty N'MS_Description', N'Start time of the job - converted to the client timezone', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'StartTimeClientTZ'
GO
EXEC sp_addextendedproperty N'MS_Description', N'End time of the job - converted to the client timezone', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'EndTimeClientTZ'
GO
EXEC sp_addextendedproperty N'MS_Description', N'The time cancellation of the job was requested - converted to the client timezone', 'SCHEMA', N'sf', 'VIEW', N'vJobRun#Ext', 'COLUMN', N'CancellationRequestTimeClientTZ'
GO
